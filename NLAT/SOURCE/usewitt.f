      subroutine usewitt(nmax,h,L,whittaker,C,start,Ek,eta)
c     small program to compute whittacker function using the witt subroutine
c     of phystm library.
      implicit none
      integer :: lzc,lzf, i, n
      integer :: l,nmax,start
      real*8 :: Ac,Af,Apr,kZc,kZf,deuxm,E,Ek,eta,r,pi,hc,e2,hm,C
      real*8 :: al,am,z,whit,h,whittaker(nmax),whit1
      real*8, parameter :: EPSW=1d-4

      pi=acos(-1d0)
      hc=197.32705359d0
      e2=1.43997
      r = 0d0
      al=-eta
      am=L+0.5d0

!      Apr=Af+Ac
!      Ek=sqrt(-C*E)
!      eta=kZf*kZc*e2*C/Ek/2


c Radius ar which the Whittacker function is evaluated   
      if (start==0) then
        do i = 1,nmax      
          r=i*h 
          z=2*Ek*r
          call witt(al,am,z,whit,whit1,EPSW)
          whittaker(i)=whit
        end do
      end if
      if (start==1) then
        do i=1,(nmax-1)
          whittaker(i)=1.0
        end do        
        do i=(nmax-1),nmax
          r=i*h 
          z=2*Ek*r
          call witt(al,am,z,whit,whit1,EPSW)
          whittaker(i)=whit
        end do
      end if
      end subroutine

      SUBROUTINE WITT(AL,AM,X,W,WP,EPS)
      IMPLICIT REAL*8 (A-H,O-Z) 
      CALL WIT1(AL-1,AM,X,W1,EPS)
      CALL WIT1(AL-2,AM,X,W2,EPS)
      W=(X-2*(AL-1))*W1+(AM+1.5d0-AL)*(AM-1.5d0+AL)*W2
      WP=(AL/X-0.5d0)*W-(AM-AL+0.5d0)*(AM+AL-0.5d0)*W1/X
      RETURN
      END
      SUBROUTINE WIT1(AL,AM,X,W,EPS)
      IMPLICIT REAL*8 (A-H,O-Z) 
      AP=0.5d0+AM-AL
      BP=1+AM+AM
      W1=0
      DO1 L=1,7
      CALL WIT(L,AP,BP,X,W2)
      IF(ABS((W1-W2)/W2).LT.EPS)GOTO2
      W1=W2
    1 CONTINUE
!      PRINT1000,AL,AM,X,EPS
    2 W=W2*X**AL*EXP(-X/2)/GAMA(AP)
      RETURN
! 1000 FORMAT('PAS DE CONVERGENCE COWITT,AL,AM,X,EPS=',1P,4d13.5)
      END
      SUBROUTINE WIT(L,AP,BP,X,W)
      IMPLICIT REAL*8 (A-H,O-Z) 
      dimension KLA(8),AI(136),R(136)
      DATA KLA/ 0, 4,12,24,40,64,96,136/
      DATA (AI(I),I=  1,52 )/
     1  3.2254768961939D-01, 1.7457611011584D+00, 4.5366202969211D+00,
     1  9.3950709123010D+00,
     1  1.7027963230510D-01, 9.0370177679937D-01, 2.2510866298660D+00,
     1  4.2667001702877D+00, 7.0459054023936D+00, 1.0758516010181D+01,
     1  1.5740678641278D+01, 2.2863131736889D+01,
     1  1.1572211735804D-01, 6.1175748451513D-01, 1.5126102697764D+00,
     1  2.8337513377435D+00, 4.5992276394182D+00, 6.8445254531150D+00,
     1  9.6213168424567D+00, 1.3006054993306D+01, 1.7116855187462D+01,
     1  2.2151090379396D+01, 2.8487967250984D+01, 3.7099121044467D+01,
     1  8.7649410478933D-02, 4.6269632891507D-01, 1.1410577748312D+00,
     1  2.1292836450983D+00, 3.4370866338932D+00, 5.0780186145497D+00,
     1  7.0703385350481D+00, 9.4383143363917D+00, 1.2214223368866D+01,
     1  1.5441527368781D+01, 1.9180156856753D+01, 2.3515905693991D+01,
     1  2.8578729742881D+01, 3.4583398702284D+01, 4.1940452647686D+01,
     1  5.1701160339542D+01,
     1  5.9019852181480D-02, 3.1123914619844D-01, 7.6609690554590D-01,
     1  1.4255975908036D+00, 2.2925620586321D+00, 3.3707742642089D+00,
     1  4.6650837034671D+00, 6.1815351187366D+00, 7.9275392471720D+00,
     1  9.9120980150776D+00, 1.2146102711729D+01, 1.4642732289596D+01/
      DATA (AI(I),I= 53,108)/
     1  1.7417992646508D+01, 2.0491460082615D+01, 2.3887329848169D+01,
     1  2.7635937174332D+01, 3.1776041352373D+01, 3.6358405801649D+01,
     1  4.1451720484868D+01, 4.7153106445154D+01, 5.3608574544692D+01,
     1  6.1058531447214D+01, 6.9962240035101D+01, 8.1498279233948D+01,
     1  4.4489365833263D-02, 2.3452610951958D-01, 5.7688462930186D-01,
     1  1.0724487538177D+00, 1.7224087764446D+00, 2.5283367064257D+00,
     1  3.4922132730219D+00, 4.6164567697496D+00, 5.9039585041741D+00,
     1  7.3581267331861D+00, 8.9829409242124D+00, 1.0783018632539D+01,
     1  1.2763697986742D+01, 1.4931139755522D+01, 1.7292454336715D+01,
     1  1.9855860940335D+01, 2.2630889013196D+01, 2.5628636022458D+01,
     1  2.8862101816323D+01, 3.2346629153963D+01, 3.6100494805750D+01,
     1  4.0145719771537D+01, 4.4509207995752D+01, 4.9224394987306D+01,
     1  5.4333721333392D+01, 5.9892509162130D+01, 6.5975377287930D+01,
     1  7.2687628090655D+01, 8.0187446977905D+01, 8.8735340417883D+01,
     1  9.8829542868275D+01, 1.1175139809793D+02,
     1  3.5700394308758D-02, 1.8816228315858D-01, 4.6269428131451D-01,
     1  8.5977296397281D-01, 1.3800108205271D+00, 2.0242091359225D+00,
     1  2.7933693535066D+00, 3.6887026779080D+00, 4.7116411465546D+00,
     1  5.8638508783433D+00, 7.1472479081018D+00, 8.5640170175858D+00/
      DATA (AI(I),I=109,136)/
     1  1.0116634048452D+01, 1.1807892294004D+01, 1.3640933712536D+01,
     1  1.5619285893338D+01, 1.7746905950095D+01, 2.0028232834574D+01,
     1  2.2468249983498D+01, 2.5072560772425D+01, 2.7847480009168D+01,
     1  3.0800145739444D+01, 3.3938657084912D+01, 3.7272245880475D+01,
     1  4.0811492823884D+01, 4.4568603175330D+01, 4.8557763533054D+01,
     1  5.2795611187213D+01, 5.7301863323389D+01, 6.2100179072770D+01,
     1  6.7219370927125D+01, 7.2695158847608D+01, 7.8572802911565D+01,
     1  8.4911231135695D+01, 9.1789874671229D+01, 9.9320808717441D+01,
     1  1.0767244063938D+02, 1.1712230951268D+02, 1.2820184198825D+02,
     1  1.4228004446916D+02/
      DATA (R(I),I=  1,52 )/
     1  8.3273912383786D-01, 2.0481024384543D+00, 3.6311463058215D+00,
     1  6.4871450844076D+00,
     1  4.3772341049290D-01, 1.0338693476656D+00, 1.6697097656587D+00,
     1  2.3769247017586D+00, 3.2085409133480D+00, 4.2685755108251D+00,
     1  5.8180833686718D+00, 8.9062262152922D+00,
     1  2.9720963604447D-01, 6.9646298043062D-01, 1.1077813946158D+00,
     1  1.5384642390428D+00, 1.9983276062742D+00, 2.5007457691008D+00,
     1  3.0653215182824D+00, 3.7232891107827D+00, 4.5298140299818D+00,
     1  5.5972584618353D+00, 7.2129954609262D+00, 1.0543837461910D+01,
     1  2.2503631486429D-01, 5.2583605276235D-01, 8.3196139168709D-01,
     1  1.1460992409637D+00, 1.4717513169668D+00, 1.8131346873813D+00,
     1  2.1755175196946D+00, 2.5657627501650D+00, 2.9932150863713D+00,
     1  3.4712344831021D+00, 4.0200440864446D+00, 4.6725166077329D+00,
     1  5.4874206579862D+00, 6.5853612332889D+00, 8.2763579843641D+00,
     1  1.1824277551659D+01,
     1  1.5149441285947D-01, 3.5325658252990D-01, 5.5678456328812D-01,
     1  7.6268531769732D-01, 9.7187263224651D-01, 1.1853578930378D+00,
     1  1.4042656272844D+00, 1.6298686157570D+00, 1.8636350553320D+00,
     1  2.1072911510814D+00, 2.3629058910419D+00, 2.6330087531638D+00/
      DATA (R(I),I= 53,108)/
     1  2.9207575797277D+00, 3.2301851334923D+00, 3.5665733773686D+00,
     1  3.9370437554551D+00, 4.3515311888634D+00, 4.8244818548978D+00,
     1  5.3780220797891D+00, 6.0484178126197D+00, 6.9008983521807D+00,
     1  8.0699651561471D+00, 9.9027933194843D+00, 1.3820532094793D+01,
     1  1.1418710576812D-01, 2.6606521689761D-01, 4.1879313732490D-01,
     1  5.7253284649977D-01, 7.2764878838098D-01, 8.8453671934022D-01,
     1  1.0436188758921D+00, 1.2053492741523D+00, 1.3702213385218D+00,
     1  1.5387772564687D+00, 1.7116193526864D+00, 1.8894240634494D+00,
     1  2.0729593402465D+00, 2.2631066339970D+00, 2.4608890724883D+00,
     1  2.6675081263971D+00, 2.8843920929220D+00, 3.1132613270395D+00,
     1  3.3562176925959D+00, 3.6158698564843D+00, 3.8955130449484D+00,
     1  4.1993941047115D+00, 4.5331149785341D+00, 4.9042702876116D+00,
     1  5.3235009720236D+00, 5.8063332142336D+00, 6.3766146741598D+00,
     1  7.0735265807070D+00, 7.9676935092955D+00, 9.2050403312780D+00,
     1  1.1163013090768D+01, 1.5390180415262D+01,
     1  9.1625471157176D-02, 2.1342058490497D-01, 3.3571811668027D-01,
     1  4.5854093503343D-01, 5.8206816577905D-01, 7.0649521636717D-01,
     1  8.3202690300345D-01, 9.5887819879439D-01, 1.0872761620305D+00,
     1  1.2174623279777D+00, 1.3496954913567D+00, 1.4842549297768D+00/
      DATA (R(I),I=109,136)/
     1  1.6214441628118D+00, 1.7615953746767D+00, 1.9050746658947D+00,
     1  2.0522883472617D+00, 2.2036905532450D+00, 2.3597925385232D+00,
     1  2.5211741403764D+00, 2.6884980554088D+00, 2.8625278132105D+00,
     1  3.0441506653115D+00, 3.2344070972636D+00, 3.4345293984277D+00,
     1  3.6459928249939D+00, 3.8705845972164D+00, 4.1104986804328D+00,
     1  4.3684687232542D+00, 4.6479589840745D+00, 4.9534461124097D+00,
     1  5.2908484059009D+00, 5.6682046090332D+00, 6.0967964147430D+00,
     1  6.5931088610398D+00, 7.1824959955372D+00, 7.9066663113853D+00,
     1  8.8408924928109D+00, 1.0140899265621D+01, 1.2210021299206D+01,
     1  1.6705520642027D+01/
      save
      NW1=KLA(L)+1
      NW2=KLA(L+1)
      W=0
      DO201 I=NW1,NW2
      XX=AI(I)
  201 W=W+R(I)*XX**(AP-1)*(1+XX/X)**(BP-AP-1)*EXP(-XX)
      RETURN
      END
*GAMMA
      FUNCTION GAMA (XX)
C 
C     GAMMA FUNCTION  
C---                              BY CHEBYSHEV POLYNOMIALS
C     LOGARITHM OF GAMMA FUNCTION 
C---                                             - CDC 6400 - 
C 
      IMPLICIT REAL*8 (A-H,O-Z) 
      DIMENSION CT(20),B(5)
      SAVE  
      DATA B / 12,-360,1260,-1680,1188/
      DATA ALPID/ 0.91893853320467d0/ 
      DATA CK / 0.57721566490153d0/ 
      DATA PI /3.1415926535898d0/ 
C 
      DATA CT/1.8835711955910D0, 0.44153813248410D-2, 
     1        0.56850436815994  D-1,-0.42198353964186  D-2, 
     2        0.13268081812125  D-2,-0.18930245297989  D-3, 
     3        0.36069253274412  D-4,-0.60567619044609  D-5, 
     4        0.10558295463023  D-5,-0.18119673655426  D-6, 
     5        0.3117724964715   D-7,-0.535421963902    D-8, 
     6 0.91932755199D- 9,-0.15779412803D- 9, 0.2707980623 D-10, 
     7-0.464681865  D-11, 0.79733502   D-12,-0.13680782   D-12, 
     8 0.2347319    D-13,-0.402743     D-14/
C 
C *************************** GAMMA (X) *************************** 
C 
      ENTRY GAMMA(XX) 
      X=XX  
      LY   = 1
      IF (X.LE.0) GO TO 99 
  100 IF (X.LE.1.0d-6) GO TO 300
      IF (X.EQ.2) GO TO 10
      Y    = X - 1  
      LG    = 1 
      T     = Y 
      IF (Y) 1,10,2 
    1 IY    = ABS(Y)+1
      T     = Y + IY 
      LG    = 2 
      GO TO 3 
    2 IF (Y.LE.1) GO TO 3 
      IY    = Y 
      T     = Y - IY 
      LG    = 3 
    3 F     = 4*T - 2
      A2    = CT(20)  
      A1    = F * A2      + CT(19)
      DO 4 I=3,18,2 
      J     = 20 - I  
      A2    = F * A1 - A2 + CT(J+1) 
      A1    = F * A2 - A1 + CT(J) 
    4 CONTINUE
      A2    = F * A1 - A2 + CT(2) 
      A2    = F * A2 - A1 + CT(1) 
      A     = (A2-A1)/2     
      IF(LG-2)5,6,8 
    5 GAMA = A
      IF (LY.EQ.2) GO TO 200
      GOTO11
    6 D     = 1 
      DO 7 I=1,IY 
      D     = D * (T - (I-1))
    7 CONTINUE
      GAMA = A / D
      IF (LY.EQ.2) GO TO 200
      GOTO11
    8 D     = 1
      DO 9 I=1,IY 
      D     = D * (T + I)
    9 CONTINUE
      GAMA = A * D
      IF (LY.EQ.1) GOTO11 
  200 GAMA = LOG(GAMA)
      GOTO11
   10 GAMA = 1
      IF (LY.EQ.1) GOTO11 
      GAMA = 0
      GOTO11
C 
C ************************* LOG GAMMA (X) ************************* 
C 
      ENTRY ALGAMA(XX)
      X=XX  
      LY   = 2
      IF (X.LE.0) GO TO 99 
   20 IF (X.LT.15) GO TO 100 
      XL   = LOG(X) 
      GAMA = X*(XL-1)-XL/2+ALPID
      IF (X.GT.2**12) GOTO11
      XL   = X * X
      F    = X
      G    = 1/(X*B(1))
      DO 21 I=2,5 
      F    = XL * F 
      G    = G + 1/(F*B(I))
   21 CONTINUE
      GAMA = GAMA + G 
      GOTO11
  300 ZZ   = (CK * X + 1) * X 
      GAMA = 1/ZZ 
      IF(LY.EQ.2)GOTO200
      GOTO11
   99 X=-X+1 
      IF(X.EQ.INT(X))GOTO12
      IF(LY.EQ.2)GOTO20 
      GOTO100 
   11 IF(XX.GT.0)RETURN
      IF(LY.EQ.1)GAMA=PI/(GAMA*SIN(PI*X)) 
      IF(LY.EQ.2)GAMA=GAMA+LOG(PI/ABS(SIN(PI*X))) 
      RETURN
   12 PRINT1000,INT(XX) 
      GAMA=0 
      RETURN
 1000 FORMAT(8H GAMMA (,I4,15H ) N EXISTE PAS)
      END
